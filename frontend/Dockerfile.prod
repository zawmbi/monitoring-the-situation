# Stage 1: Build
FROM node:20-alpine AS build
WORKDIR /app

# Copy root workspace files for vite.config.js env resolution
COPY package*.json /monorepo/
COPY .env* /monorepo/

WORKDIR /monorepo/frontend
COPY frontend/package*.json ./
RUN npm install

COPY frontend/ ./
RUN npm run build

# Stage 2: Serve static files
FROM node:20-alpine
WORKDIR /app
RUN npm install -g serve@14
COPY --from=build /monorepo/frontend/dist ./dist

EXPOSE 3000

CMD ["serve", "-s", "dist", "-l", "3000"]
